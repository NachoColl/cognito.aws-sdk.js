var AWSConstants={region:"us-west-2",cognitoEndpoint:"cognito-idp.us-west-2.amazonaws.com",userPoolId:"us-west-2_YPTpsHBH2",clientId:"afc9gnnlvi3dbgtick3cve76s",identityPoolId:"us-west-2:89c94bea-2b40-4a16-af9b-e3f2287dbdd9",S3LandingPageBucket:"files.landingpage.services",S3BaseTemplatesBucket:"cdn.services",cognitoApiGateway:"https://8uzq72yjve.execute-api.us-west-2.amazonaws.com/v1/"};AWS.config.region=AWSConstants.region,AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId}),AWSCognito.config.region=AWSConstants.region,AWSCognito.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId});var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:AWSConstants.userPoolId,ClientId:AWSConstants.clientId}),cognitoUser=null,token=null,refreshToken=null,email=null,password=null;jQuery(function(){if(!(window.location.href.indexOf("index.html")>-1))if(token=Cookies.get("idToken"),refreshToken=Cookies.get("refreshToken"),token&&refreshToken){var e={};e[AWSConstants.cognitoEndpoint+"/"+AWSConstants.userPoolId]=token,AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId,Logins:e}),AWSUtils.refreshTokens(),AWS.config.credentials.get(function(e){e?console.log(e,e.stack):"undefined"!=typeof AWSPageInit&&$.isFunction(AWSPageInit)&&AWSPageInit()})}else AWSUtils.logout()});var AWSUtils=function(){return{refreshTokens:function(){userPool.client.makeUnauthenticatedRequest("initiateAuth",{ClientId:AWSConstants.clientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:{REFRESH_TOKEN:refreshToken}},function(e,t){if(e)AWSUtils.logout();else{Cookies.set("accessToken",t.AuthenticationResult.AccessToken),Cookies.set("idToken",t.AuthenticationResult.IdToken);var a={};a[AWSConstants.cognitoEndpoint+"/"+AWSConstants.userPoolId]=t.AuthenticationResult.IdToken,AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId,Logins:a})}),AWS.config.credentials.get(function(e){e&&console.log(e,e.stack)})}}),setTimeout(AWSUtils.refreshTokens,3e6)},logout:function(){Cookies.set("accessToken",""),Cookies.set("idToken",""),Cookies.set("refreshToken",""),null!=cognitoUser&&(cognitoUser.signOut(),cognitoUser=null),AWS.config.credentials.clearCachedId(),"undefined"!=typeof goHome&&$.isFunction(goHome())?goHome():window.location.href="index.html"}}}(),RegistrationForm=function(){function t(){$(".Exception").hide();var e=[],t={Name:"email",Value:email.toLowerCase()},a=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(t);e.push(a),userPool.signUp(guid(),password,e,null,function(e,t){return ready(),e?void i(e):(cognitoUser=t.user,void $(".registration").toggle())})}function a(e){$(".Exception").hide(),cognitoUser.confirmRegistration(e,!0,function(e,t){return ready(),e?void i(e):void LoginForm.login()})}function n(){$(".Exception").hide(),cognitoUser.resendConfirmationCode(function(e,t){return ready(),e?void i(e):void $(".register-codesent").show()})}function i(e){switch(e.code){case"InvalidParameterException":$(".register-InvalidParameterException").show();break;case"UsernameExistsException":$(".register-UsernameExistsException").show();break;case"CodeMismatchException":$(".register-CodeMismatchException").show();break;case"UserLambdaValidationException":$(".register-UsernameExistsException").show();break;default:$(".register-UnexpectedException").show()}}var e=function(){jQuery(".js-validation-register").validate({errorClass:"help-block text-right animated fadeInDown",errorElement:"div",errorPlacement:function(e,t){jQuery(t).parents(".form-group > div").append(e)},highlight:function(e){jQuery(e).closest(".form-group").removeClass("has-error").addClass("has-error"),jQuery(e).closest(".help-block").remove()},success:function(e){jQuery(e).closest(".form-group").removeClass("has-error"),jQuery(e).closest(".help-block").remove()},rules:{"register-email":{required:!0,email:!0},"register-password":{required:!0,minlength:6}},messages:{"register-email":"Please enter a valid email address","register-password":{required:"Please provide a password",minlength:"Your password must be at least 6 characters long"}}}),jQuery(".js-validation-verify").validate({errorClass:"help-block text-right animated fadeInDown",errorElement:"div",errorPlacement:function(e,t){jQuery(t).parents(".form-group > div").append(e)},highlight:function(e){jQuery(e).closest(".form-group").removeClass("has-error").addClass("has-error"),jQuery(e).closest(".help-block").remove()},success:function(e){jQuery(e).closest(".form-group").removeClass("has-error"),jQuery(e).closest(".help-block").remove()},rules:{"verify-code":{required:!0}},messages:{"verify-code":{required:"Please provide a code"}}}),jQuery("#btn-register").on("click",function(e){e.preventDefault(),jQuery(".js-validation-register").valid()?(email=$("#register-email").val(),password=$("#register-password").val(),t()):ready()}),jQuery("#btn-verify").on("click",function(e){e.preventDefault(),jQuery(".js-validation-verify").valid()?a($("#verify-code").val()):ready()}),jQuery("#btn-verify-resend").on("click",function(e){e.preventDefault(),n(),ready()})};return{init:function(){e()}}}(),LoginForm=function(){function t(){$(".Exception").hide();var e={Username:email.toLowerCase(),Password:password},t=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationDetails(e),n={Username:email.toLowerCase(),Pool:userPool};cognitoUser=new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(n),cognitoUser.authenticateUser(t,{onSuccess:function(e){Cookies.set("accessToken",e.getAccessToken().getJwtToken()),Cookies.set("idToken",e.idToken.jwtToken),Cookies.set("refreshToken",e.refreshToken.token);new AWSCognito.CognitoIdentityServiceProvider.CognitoRefreshToken({RefreshToken:e.refreshToken.token,IdToken:e.idToken.jwtToken});"undefined"!=typeof goInitialPage&&$.isFunction(goInitialPage)&&goInitialPage()},onFailure:function(e){a(e)}})}function a(e){switch(e.code){case"UserNotFoundException":case"NotAuthorizedException":$(".login-UserNotFoundException").show();break;case"UserNotConfirmedException":case"PasswordResetRequiredException":$(".login-UserNotConfirmedException").show(),n();break;default:$(".login-UnexpectedException").show()}}function n(){$("#registration").hide(),$("#verification").show(),$(".how-to-use-title").hide(),$(".how-to-use-form").show()}var e=function(){jQuery("#btn-login").on("click",function(e){e.preventDefault(),""!=$("#login-username").val()&&""!=$("#login-password").val()?(email=$("#login-username").val(),password=$("#login-password").val(),t()):ready()}),$("#login-password").keypress(function(e){return e.which&&13==e.which||e.keyCode&&13==e.keyCode?($("#btn-login").click(),!1):!0})};return{init:function(){e()},login:function(){t()}}}(),ResetPasswordForm=function(){function t(e){var t={email:e};$.ajax({method:"POST",url:"https://tphxw0c862.execute-api.us-west-2.amazonaws.com/v1/user/reset",data:JSON.stringify(t),headers:{"Content-Type":"application/json"},dataType:"json",success:function(e){switch(ready(),e.code){case-2:$(".recover-UserNotFound").show();break;case-3:switch(e.error.code){case"LimitExceededException":$(".recover-LimitExeeded").show();break;default:$(".recover-UnexpectedException").show()}break;case 0:$(".recover-steps").toggle();break;default:$(".recover-UnexpectedException").show()}},error:function(e,t,a){ready(),$(".recover-UnexpectedException").show()}})}function a(e,t,a){var n={email:e,code:t,password:a};$.ajax({method:"POST",url:"https://tphxw0c862.execute-api.us-west-2.amazonaws.com/v1/user/reset/confirm",data:JSON.stringify(n),headers:{"Content-Type":"application/json"},dataType:"json",success:function(t){switch(console.log(t),ready(),t.code){case-2:$(".recover-UserNotFound").show();break;case-3:switch(t.error.code){case"LimitExceededException":$(".recover-LimitExeeded").show();break;case"CodeMismatchException":$(".recover-InvalidCode").show();break;default:$(".recover-UnexpectedException").show()}break;case 0:email=e,password=a,LoginForm.login();break;default:$(".recover-UnexpectedException").show()}},error:function(e,t,a){ready(),$(".recover-UnexpectedException").show()}})}var e=function(){jQuery(".js-validation-reset").validate({errorClass:"help-block text-right animated fadeInDown",errorElement:"div",errorPlacement:function(e,t){jQuery(t).parents(".form-group > div").append(e)},highlight:function(e){jQuery(e).closest(".form-group").removeClass("has-error").addClass("has-error"),jQuery(e).closest(".help-block").remove()},success:function(e){jQuery(e).closest(".form-group").removeClass("has-error"),jQuery(e).closest(".help-block").remove()},rules:{"email-recover":{required:!0,email:!0}},messages:{"email-recover":"Please enter a valid email address"}}),jQuery("#btn-recover").on("click",function(e){e.preventDefault(),""!=$("#email-recover").val()?t($("#email-recover").val()):ready()}),jQuery(".js-validation-reset-confirm").validate({errorClass:"help-block text-right animated fadeInDown",errorElement:"div",errorPlacement:function(e,t){jQuery(t).parents(".form-group > div").append(e)},highlight:function(e){jQuery(e).closest(".form-group").removeClass("has-error").addClass("has-error"),jQuery(e).closest(".help-block").remove()},success:function(e){jQuery(e).closest(".form-group").removeClass("has-error"),jQuery(e).closest(".help-block").remove()},rules:{"code-recover":{required:!0},"password-recover":{required:!0,minlength:6}},messages:{"code-recover":{required:"Please provide a code"},"password-recover":{required:"Please provide a new password",minlength:"Your password must be at least 6 characters long"}}}),jQuery("#btn-confirm-recover").on("click",function(e){e.preventDefault(),""!=$("#email-recover").val()&&""!=$("#code-recover").val()&&""!=$("#password-recover").val()?a($("#email-recover").val(),$("#code-recover").val(),$("#password-recover").val()):ready()})};return{init:function(){e()}}}(),Template=function(){var e=function(){ready(),showTemporaly(".UnexpectedException")},t=function(t,a,n,i){var o=function(t){switch(t.code){case 0:"undefined"!==n&&$.isFunction(n)&&n(t);break;default:"undefined"!==i&&$.isFunction(i)?i(t):e()}};json(a,t,o,e)};return{list:function(e){t("sitebuilder/template/list",null,e)},update:function(e,a){t("sitebuilder/template/update",e,a)},get:function(e,a){t("sitebuilder/template/get",e,a)},"delete":function(e,a,n){t("sitebuilder/template/delete",e,a,n)}}}(),Page=function(){var e=function(){ready(),$(".UnexpectedException").show()},t=function(t,a,n){var i=function(t){switch(t.code){case 0:$.isFunction(n)&&n(t);break;default:e()}};json(a,t,i,e)};return{list:function(e){t("sitebuilder/page/list",null,e)},update:function(e,a){t("sitebuilder/page/update",e,a)},get:function(e,a){t("sitebuilder/page/get",e,a)},"delete":function(e,a){t("sitebuilder/page/delete",e,a)}}}(),Domains=function(){var e=function(){ready(),showTemporaly(".Domains-UnexpectedException")},t=function(t,a,n){var i=function(t){switch(t.code){case 0:$.isFunction(n)?n(t):ready();break;default:e()}};json(a,t,i,e)};return{list:function(e,a){var n={};n.page={guid:e},t("sitebuilder/domain/list",n,a)},update:function(e,a,n,i,o){var r={};r.page={guid:e,name:a},r.domain={name:n,isDefault:i},t("sitebuilder/domain/update",r,o)},"delete":function(e,a,n,i){var o={};o.page={guid:e,name:a},o.domain={name:n},t("sitebuilder/domain/delete",o,i)}}}(),S3Images=function(){var e=null,t=function(){e.listObjects({Prefix:AWS.config.credentials.identityId+"/assets/images"},function(e,t){if(e)console.log(e);else{$("#S3Images-picker option").remove(),$.each(t.Contents,function(e,t){$("#S3Images-picker").append('<option data-img-src="https://s3-us-west-2.amazonaws.com/files.landingpage.services/'+t.Key+'" data-img-class = "img-responsive" value = "'+t.Key+'" /> ')}),$("#S3Images-picker").imagepicker(),$("#btn-image").show(),ready()}})},a=function(a){e.deleteObject({Key:a},function(e,a){e&&(ready(),console.log("There was an error deleting photo: "+e.message)),t()})},n=function(){$("#insert-image-confirm").on("click",function(e){e.preventDefault(),"undefined"!=typeof currentMustache&&null!==currentMustache?currentMustache.replaceSelection('<img src="https://s3-us-west-2.amazonaws.com/files.landingpage.services/'+$("#S3Images-picker").val()+'" />'):myCodeMirror.replaceSelection('<img src="https://s3-us-west-2.amazonaws.com/files.landingpage.services/'+$("#S3Images-picker").val()+'" />'),$("#insert-image").modal("hide"),ready()}),$("#insert-image-confirm-responsive").on("click",function(e){e.preventDefault(),"undefined"!=typeof currentMustache&&null!==currentMustache?currentMustache.replaceSelection('<img src="https://s3-us-west-2.amazonaws.com/files.landingpage.services/'+$("#S3Images-picker").val()+'" class="img-responsive" />'):myCodeMirror.replaceSelection('<img src="https://s3-us-west-2.amazonaws.com/files.landingpage.services/'+$("#S3Images-picker").val()+'" class="img-responsive" />'),$("#insert-image").modal("hide"),ready()}),$("#insert-image-delete").on("click",function(e){e.preventDefault(),$("#S3Images-picker").val()?S3Images["delete"]($("#S3Images-picker").val()):ready()}),$("#cancel-insert-image").on("click",function(e){e.preventDefault(),ready()})},i=function(){function a(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#drop").on("dragover",function(e){e.preventDefault(),e.stopPropagation(),$("#drop").addClass("dragover")}),$("#drop").on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$("#drop").removeClass("dragover")}),$("#drop").on("drop",function(e){e.preventDefault(),e.stopPropagation(),$("#drop").removeClass("dragover"),document.getElementById("image-upload-select").files=e.originalEvent.dataTransfer.files}),$("#image-upload-select").change(function(){var n=document.getElementById("image-upload-select").files.length,i=0;$("#upload ul li").remove(),$.each(document.getElementById("image-upload-select").files,function(o,r){var s=$('<li class="working"><input type="text" value="0" data-width="48" data-height="48" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p><span></span></li>');s.find("p").text(r.name).append("<i>"+a(r.size)+"</i>"),s.appendTo($("#upload ul")),s.find("input").knob();var l=AWS.config.credentials.identityId+"/assets/images/"+r.name.replace(/ /gi,"-"),c=e.putObject({Key:l,ContentType:r.type,Body:r},function(e,a){return i++,i==n&&t(),e?(s.addClass("error"),s.find("p").find("i").text("There was an error uploading your photo"),console.log("There was an error uploading your photo: ",e.message)):void 0});c.on("httpUploadProgress",function(e){var t=parseInt(e.loaded/e.total*100,10);s.find("input").val(t).change()}),c.send()})}),$(document).on("drop dragover",function(e){e.preventDefault()})};return{init:function(){e=new AWS.S3({apiVersion:"2006-03-01",region:"us-west-2",params:{Bucket:AWSConstants.S3LandingPageBucket}}),n(),i()},list:function(){t()},"delete":function(e){a(e)}}}(),S3BaseTemplates=function(){var e=null,t=null,a=function(){$("#btn-confirm-insert-template").on("click",function(a){a.preventDefault(),e.getObject({Key:"html-templates/"+t+"/"+t+".html"},function(e,t){e?console.log(e):(myCodeMirror.setValue(html_beautify(i(t.Body))),$("#confirm-insert-template").modal("hide"),$("#insert-template").modal("hide"),myCodeMirror.focus(),ready())})})},n=function(){e.listObjects({Prefix:"html-templates/",Delimiter:"/"},function(t,a){t?console.log(t):($.each(a.Contents,function(t,a){if("undefined"!=typeof a.Key&&a.Key.endsWith("jpg")){var n=a.Key.substr(a.Key.lastIndexOf("/")+1),o=n.substr(0,n.lastIndexOf("."));$(".templates-preview").append('<div class="col-lg-6 animated fadeIn" id="template-'+o+'"><div class="img-container"><img class="img-responsive img-preview-template" src="https://s3-us-west-2.amazonaws.com/cdn.services/'+a.Key+'"><div class="img-options"><div class="img-options-content"><h3 class="font-w400 text-white push-5">'+a.Key+'</h3><h5 class="font-w400 text-white push-5"></h5><div class="push-20-t"><a class="btn btn-sm btn-default btn-noaction push-5-r" href="" target="_blank"><i class="fa fa-eye"></i> Preview</a><span class="btn btn-sm btn-danger btn-noaction" data-toggle="modal" data-target="#confirm-insert-template" data-backdrop="static"  onclick="S3BaseTemplates.select(\''+o+'\')"><i class="fa fa-hand-pointer-o"></i> Select</span></div></div></div></div></div>'),e.getObject({Key:"html-templates/"+o+"/"+o+".txt"},function(e,t){if(e)console.log(e);else{var a=i(t.Body).split("\n");$("#template-"+o+" .img-options-content h3").html(a[0]),$("#template-"+o+" .img-options-content h5").html(a[1]),$("#template-"+o+" .img-options-content a").attr("href",a[2])}})}}),$("#select-base-template").show())})},i=function(e){for(var t="",a=0;a<e.length;a++)t+=String.fromCharCode(e[a]);return t};return{init:function(){e=new AWS.S3({apiVersion:"2006-03-01",region:"us-west-2",params:{Bucket:AWSConstants.S3BaseTemplatesBucket}}),a()},list:function(){n()},select:function(e){t=e}}}();